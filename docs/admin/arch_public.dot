digraph G {

  node [style=filled, shape=box, fillcolor="#ffffcc", fontname=Sans];
  edge [fontname="Sans"];

  browser [label="browser", shape=tab, fillcolor=aliceblue];
  rp      [label="reverse proxy"];
  static  [label="static files", shape=folder, href="url to configure static files", fillcolor=lightgray];
  uwsgi   [label="uwsgi", shape=parallelogram href="https://docs.zhensa.org/utils/zhensa.sh.html"]
  valkey  [label="valkey DB", shape=cylinder];

  zhensa1  [label="Zhensa #1", fontcolor=blue3];
  zhensa2  [label="Zhensa #2", fontcolor=blue3];
  zhensa3  [label="Zhensa #3", fontcolor=blue3];
  zhensa4  [label="Zhensa #4", fontcolor=blue3];

  browser -> rp [label="HTTPS"]

  subgraph cluster_zhensa {
      label = "Zhensa instance" fontname=Sans;
      bgcolor="#fafafa";
      { rank=same; static rp };
      rp -> static  [label="optional: reverse proxy serves static files", fillcolor=slategray, fontcolor=slategray];
      rp -> uwsgi [label="http:// (tcp) or unix:// (socket)"];
      uwsgi -> zhensa1 -> valkey;
      uwsgi -> zhensa2 -> valkey;
      uwsgi -> zhensa3 -> valkey;
      uwsgi -> zhensa4 -> valkey;
  }

}
